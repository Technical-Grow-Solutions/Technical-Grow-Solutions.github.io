<!--PRIVATE document PROTECTED BY INTERNATIONAL LAW.-->
<!-- ©2023 Technical Grow Solutions (TGS)-->
<!--Language: en - CreationTime(UDT):")) + Date_Time_str  -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 strict //EN">
<html lang="en">
  <head>
    <!--<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">-->
    <!-- &#169 = Copyright, &#174 = REGISTERED SIGN, &#8364 = EURO SIGN, &#8482 = Trademark-->
    <meta name="GENERATOR" content="TGS">
    <meta name="author" content="M.F.Saathof">
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link href="../../public/styles/page.css" rel="stylesheet" type="text/css">
    <script type="text/javascript">
      var websock;
      
      window.addEventListener('load', onLoad);
          
      function onLoad(event)
      {
          initWebSocket();
      }
      
      function initWebSocket()
      {
        if ("WebSocket" in window)
        {
          // Let us open a web socket
          //console.log('Trying to open a WebSocket connection...');
          websock = new WebSocket("ws://" + window.location.hostname + ":82");
          websock.onopen  = onOpen;
          websock.onclose = onClose;
          websock.onmessage = onMessage;
          websock.onerror = onError;
        }
        else
        {
          // The browser doesn't support WebSocket
          alert("WebSocket NOT supported by your Browser!");
        }
      }
      
      function onOpen (event) {
        console.log('Connection opened');
      }
      
      function onMessage (event)
      {
        //console.log(`Received a notification from ${event.origin}`);
        //console.log(event);

        var json = JSON.parse(event.data);
        console.log(json["Fogger"].on);

        document.getElementById("ds180now").innerText = json.DS18Bxx[0].now;
        document.getElementById("ds181now").innerText = json.DS18Bxx[1].now;
        document.getElementById("mpsnow").innerText = json.MPS20N0040D.now;
        
        if (json["Chiller"].on == true)
        {
            document.getElementById("chillon").src = "http://192.168.1.20:5500/public/images/status_green.gif";
        }
        else
        {
            document.getElementById("chillon").src = "http://192.168.1.20:5500/public/images/status_off.gif";
        }

        if (json["Heater"].on == true)
        {
            document.getElementById("heaton").src = "http://192.168.1.20:5500/public/images/status_green.gif";
        }
        else
        {
            document.getElementById("heaton").src = "http://192.168.1.20:5500/public/images/status_off.gif";
        }      

        if (json["Fogger"].on == true)
        {
            document.getElementById("fogon").src = "http://192.168.1.20:5500/public/images/status_green.gif";
        }
        else
        {
            document.getElementById("fogon").src = "http://192.168.1.20:5500/public/images/status_off.gif";
        }
      }

      function onClose (event)
      {
      if (event.wasClean)
      {
        //alert(`[close] Connection closed cleanly, code=${evt.code} reason=${evt.reason}`);
        console.log('Connection closed');
      }
      else
      {
        // e.g. server process killed or network down
        // event.code is usually 1006 in this case
        //alert('[close] Connection died');
      }
      websock.close();
      }
      
      function onError (error) {
        //alert(`[error] ${error.message}`);
      }
          
      function sendText(){
          websock.send(document.getElementById("txBar").value);
          document.getElementById("txBar").value = "";
      }
      function sendBrightness(){
          websock.send("#"+document.getElementById("brightness").value);
      }
    </script>
  </head>
  <body>
    <div id="header"><div id="headervalue">Now</div></div>
    <button onclick="fScrollToTop()" id="scroll-ToTop-button" title="Go to top">^</button>
    <div id="scroll-indicator-container"><div id="scroll-indicator-bar"></div></div>
    <div id="snackbar"></div>
    <div id="content">

      <table class="centre">
        <tr><th colspan="3">Reservoir</th></tr>
        <tr><td>Temperature:</td><td id="ds180now"></td><td>°C</td></tr>
        <tr><td>Chiller:</td><td><img id="chillon" src="/images/status [off].gif"></td><td></td></tr>
        <tr><td>Heater:</td><td><img id="heaton" src="/images/status [off].gif"></td><td></td></tr>
        <tr><td>Level:</td><td id="mpsnow"></td><td>%</td></tr>
        <tr><th colspan="3">Bucket</th></tr>
        <tr><td>Temperature:</td><td id="ds181now"></td><td>°C</td></tr>
        <tr><td>Fogger:</td><td><img id="fogon" src="/images/status [off].gif"></td><td></td></tr>
      </table>
    </div>

    <script>
      var headerShrink = document.getElementById("header");
      var butScrollToTop = document.getElementById("scroll-ToTop-button");
      var scrollIndicatorContainer = document.getElementById("scroll-indicator-container");
      var scrollIndicatorBar = document.getElementById("scroll-indicator-bar");
      window.onscroll = function() {fScroll()};
      function fScroll() 
      {
          var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
          var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
          var scrolled = (winScroll / height) * 100;
          scrollIndicatorBar.style.width = scrolled + "%";
          if (document.body.scrollTop > 50 || document.documentElement.scrollTop > 50)
          {
              headerShrink.style.fontSize = "22px";
              butScrollToTop.style.display = "block";
              //if (document.body.scrollTop < 100 || document.documentElement.scrollTop < 100){setTimeout(function(){ scrollIndicatorContainer.style.visibility = "visible";}, 1000);}
              scrollIndicatorContainer.style.visibility = "visible";
          }
          else
          {
              headerShrink.style.fontSize = "28px";
              butScrollToTop.style.display = "none";
              scrollIndicatorContainer.style.visibility = "hidden";
          }
      }
      function fScrollToTop(){
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
          document.getElementById("headervalue").innerHTML="Intro";
      }
    </script>
    <script>function fHeaderChange(bla) {document.getElementById("headervalue").innerHTML=bla;}</script>
    <script>function fSnackbar()
      {
        var x = document.getElementById("snackbar");
        x.className = "show";
        setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
      }
    </script>
        <script>
          var acc = document.getElementsByClassName("accordion");
          var i;
          for (i = 0; i < acc.length; i++) 
          {
            acc[i].addEventListener("click", function() 
            {
              this.classList.toggle("active");
    
              var allAcc = document.getElementsByClassName("accordion");
              for (var e = 0; e < allAcc.length; e++)
              {
                var aPanel = allAcc[e].nextElementSibling;
                aPanel.style.maxHeight = null;				 
              }
              var panel = this.nextElementSibling;
              if (panel.style.maxHeight)
              {
                panel.style.maxHeight = null;
              } 
              else
              {
                panel.style.maxHeight = panel.scrollHeight + "px";
              }
            })
          }
        </script>
  </body>
</html>